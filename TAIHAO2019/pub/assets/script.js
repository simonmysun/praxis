/*

  This file includes all the validations of the game. It is not recommanded to hack. However, if you really do so, you might get three keys from it without solving the problems themselves. That will be too easy and less interesting. 

*/
var e="^.*/TAIHAO2019/pub",t="(\\?.*)?",n=function(e,t){var n=JSON.parse(localStorage.status);-1===n.achievements.map(e=>e.name).indexOf(e)&&n.achievements.push({name:e,description:t}),localStorage.status=JSON.stringify(n)},a=function(e){return JSON.parse(localStorage.status)[e]},i=function(e,t){if(a(e)!==t){var i=JSON.parse(localStorage.status);if("d"!==e&&1===t||t>10){var o=0;o+=i.a>0?1:0,o+=i.b>0?1:0,o+=i.c>0?1:0,o+=i.d>0?1:0,0===(o+=i.e>0?1:0)&&(n("First Blood","Solving first problem"),i=JSON.parse(localStorage.status)),3===o&&(n("Further","4 / 5"),i=JSON.parse(localStorage.status)),4===o&&(n("AK(All Killed)","All problems solved"),i=JSON.parse(localStorage.status))}if(0===t){var s=0;s+=0===i.a?1:0,s+=0===i.b?1:0,s+=0===i.c?1:0,s+=0===i.d?1:0,(s+=0===i.e?1:0)>1&&(n("Parallelization","Trying to solve three problems at the same time"),i=JSON.parse(localStorage.status))}i[e]=t,localStorage.status=JSON.stringify(i)}},o=[{path:".*",init:()=>{window.MathJax={tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:!0}},void 0===localStorage.status&&(localStorage.status=JSON.stringify({a:-1,// -1: unopened; 0: opened, unsolved, 1+: solved
b:-1,c:-1,d:-1,e:-1,achievements:[]}))}},{path:"/(index.html)?",init:()=>{document.getElementsByTagName("form")[0].setAttribute("onsubmit","return validate()"),window.validate=(()=>{var e=document.getElementsByTagName("input")[0].value;return"f30bc8b9f9d0459116656b9ff5e5a61b"===md5(e+"\n")?alert("Success! "):alert("Fail. "),!1});var e=JSON.parse(localStorage.status);if(e.achievements.length>0){var t=document.createElement("h2");t.innerHTML="Achievements: ";var n=document.getElementById("nau");n.parentNode.insertBefore(t,n),document.getElementById("nau").innerHTML=e.achievements.map(e=>`<li>${e.name}: ${e.description}</li>`).join("")}}},{path:"/Poker/(index.html)?",init:()=>{-1===a("a")&&i("a",0),document.getElementsByTagName("form")[0].setAttribute("onsubmit","return validate()"),window.validate=(()=>{var e=document.getElementsByTagName("input")[0].value;return"5133624be1ee45e8fb8cd97a3fa48a35"===md5(e+"\n")?(alert("Success! The key is "+(23*e.split("").map(e=>e.charCodeAt(0)).reduce((e,t)=>(13*e+t)%6091)+691)+". "),i("a",1),n("Poker Master",'Finishing "Poker"')):alert("Fail. "),!1})}},{path:"/Multiplication/(index.html)?",init:()=>{-1===a("b")&&i("b",0),Array.from(document.getElementsByTagName("li")).map(e=>e.setAttribute("data-ori",e.innerText)),document.getElementsByTagName("input")[0].setAttribute("onchange","validate()"),document.getElementsByTagName("input")[0].setAttribute("onkeyup","validate()"),window.validate=function(){var e=document.getElementsByTagName("input")[0].value;e.length>200&&n("Regex Beginners","More-than-200-characters Regex");var t=new RegExp(e),a=0;if(Array.from(document.getElementsByTagName("li")).map(e=>{e.innerHTML=e.getAttribute("data-ori").replace(t,"<b><u>$&</u></b>"),e.innerHTML===e.getAttribute("data-ori")?(e.innerHTML+=" <small>(not matched)</small>",e.classList.remove("matched"),e.classList.add("unmatched"),e.classList.contains("match")&&(a+=1)):(e.classList.remove("unmatched"),e.classList.add("matched"),e.classList.contains("unmatch")&&(a+=1))}),0===a){console.log("presuccess");for(var o=1;o<=12;o+=1)for(var s=1;s<=12;s+=1)for(var r=1;r<=144;r+=1){var l="";if(l+=new Array(o).fill("x").join(""),l+="*",l+=new Array(s).fill("x").join(""),l+="=",o*s===r==((l+=new Array(r).fill("x").join(""))===l.replace(t,"<b><u>$&</u></b>")))return o*s===r?(document.getElementById("should").innerHTML+=`<li class="match" data-ori="${l}"></li>`,void validate()):(document.getElementById("should-not").innerHTML+=`<li class="unmatch" data-ori="${l}"></li>`,void validate())}i("b",1),n("I Know Regex",'Finishing "Multiplication"'),alert("Success! The key is 422. ")}}}},{path:"/Snake/(index.html)?",init:()=>{-1===a("c")&&i("c",0);var e=ace.edit("editor");e.setTheme("ace/theme/monokai"),e.session.setMode("ace/mode/javascript"),void 0===localStorage.aceRecover&&(localStorage.aceRecover="function init(w, h) {\n                    return function(snake, food) {\n                    }\n                }"),e.session.setValue(localStorage.aceRecover),e.session.on("change",function(t){localStorage.aceRecover=e.getValue(),e.session.getLength()>=1e3&&n("LOC 1000",'1000+ lines of code in "Snake"')});var t=document.getElementsByTagName("canvas")[0],o=t.getContext("2d"),s=t.width/20,r=new function(){this.delay=300};(new dat.GUI).add(r,"delay",0,500);var l=0,d=0,c=1e4,h=[],u=[],m={dx:1,dy:0},g=function(){u=[{x:4,y:0},{x:3,y:0},{x:2,y:0},{x:1,y:0},{x:0,y:0}]};g();var v=function(e){return[117*Math.sin(.27*e+1*Math.PI/3)+144,117*Math.sin(.27*e+3*Math.PI/3)+144,117*Math.sin(.27*e+5*Math.PI/3)+144]},y=[],f=new Stats;f.showPanel(0),f.dom.style.position="fixed",f.dom.style.top="auto",f.dom.style.right="0",f.dom.style.bottom="48px",f.dom.style.left="auto",document.body.appendChild(f.dom);var p=function(){for(var e in f.begin(),o.fillStyle="#111",o.fillRect(0,0,t.width,t.height),o.fillStyle="#333",o.font=.85*t.height+"px Impact, sans-serif",o.textAlign="center",o.fillText(l.toString(),t.width/2,.95*t.height),o.font=.1*t.height+"px Impact, sans-serif",o.textAlign="center",o.fillText(d.toString(),t.width/2,.24*t.height),o.font=.1*t.height+"px Impact, sans-serif",o.textAlign="center",o.fillText(c.toString(),t.width/2,.12*t.height),h){var n=h[e].x,a=h[e].y;o.fillStyle="#0074D9",o.strokeStyle="white",o.beginPath(),o.moveTo(n*s+y[0][0],a*s+y[1][0]);for(var i=1;i<8;i+=1)o.lineTo(n*s+y[0][i],a*s+y[1][i]);o.closePath(),o.fill(),o.stroke()}for(var e in u){n=u[e].x,a=u[e].y;var r=v(e);o.fillStyle=`rgba(${r[0]}, ${r[1]}, ${r[2]}, ${(1-e/u.length*.7).toString()})`,o.fillRect(n*s,a*s,s,s),o.strokeStyle="white",o.strokeRect(n*s,a*s,s,s)}f.end(),requestAnimationFrame(p)};window.addEventListener("resize",()=>{t.width=4*window.innerHeight/3,t.height=window.innerHeight,s=t.width/20,y=[[(1+.8*Math.sin(.5*Math.PI*2/8))*s/2,(1+.8*Math.sin(1.5*Math.PI*2/8))*s/2,(1+.8*Math.sin(2.5*Math.PI*2/8))*s/2,(1+.8*Math.sin(3.5*Math.PI*2/8))*s/2,(1+.8*Math.sin(4.5*Math.PI*2/8))*s/2,(1+.8*Math.sin(5.5*Math.PI*2/8))*s/2,(1+.8*Math.sin(6.5*Math.PI*2/8))*s/2,(1+.8*Math.sin(7.5*Math.PI*2/8))*s/2],[(1+.8*Math.cos(.5*Math.PI*2/8))*s/2,(1+.8*Math.cos(1.5*Math.PI*2/8))*s/2,(1+.8*Math.cos(2.5*Math.PI*2/8))*s/2,(1+.8*Math.cos(3.5*Math.PI*2/8))*s/2,(1+.8*Math.cos(4.5*Math.PI*2/8))*s/2,(1+.8*Math.cos(5.5*Math.PI*2/8))*s/2,(1+.8*Math.cos(6.5*Math.PI*2/8))*s/2,(1+.8*Math.cos(7.5*Math.PI*2/8))*s/2]],p()}),window.dispatchEvent(new Event("resize")),requestAnimationFrame(p);var x=[];document.body.addEventListener("keydown",function(e){if(e.keyCode>36&&e.keyCode<41&&-1===x.indexOf(e.keyCode)){x.push(e.keyCode);var t=1<<x[x.length-1]-37;m={dx:!!(4&t)-!!(1&t),dy:!!(8&t)-!!(2&t)}}}),document.body.addEventListener("keyup",function(e){if(e.keyCode>36&&e.keyCode<41&&(x=x.filter(t=>t!=e.keyCode)).length>0){var t=1<<x[x.length-1]-37;m={dx:!!(4&t)-!!(1&t),dy:!!(8&t)-!!(2&t)}}});var w=function(e,t){if(e<0||t<0||e>=20||t>=15)return!1;for(var n in u)if(e===u[n].x&&t===u[n].y)return!1;return!0},M=function(){for(var e=[],t=0;t<20;t+=1)for(var n=0;n<15;n+=1)w(t,n)&&e.push({x:t,y:n});var a=Math.floor(Math.random()*e.length);e.length>0&&h.push({x:e[a].x,y:e[a].y})};M();var S=function(){if(0!==(c-=1)){var e=function(){if(x.length>0){var e=1<<x[x.length-1]-37;m={dx:!!(4&e)-!!(1&e),dy:!!(8&e)-!!(2&e)}}return m}(),t=u[0].x,a=u[0].y;t+e.dx===u[1].x&&a+e.dy===u[1].y&&(e={dx:t-u[1].x,dy:a-u[1].y});var o={x:u[u.length-1].x,y:u[u.length-1].y};if(!(w(u[0].x+e.dx,u[0].y+e.dy)||t+e.dx===o.x&&a+e.dy===o.y)||300===u.length)return d+=l*l,l=0,g(),h=[],M(),void(m={dx:1,dy:0});var s=!1;for(var r in h)if(t+e.dx===h[r].x&&a+e.dy===h[r].y){s=!0,l+=1,h=h.filter((e,t)=>t!=r);break}for(r=u.length-1;r>0;r-=1)u[r]={x:u[r-1].x,y:u[r-1].y};u[0]={x:t+e.dx,y:a+e.dy},s&&u.push(o),h.length<1&&M()}else if(d+=l*l,l=0,g(),h=[],M(),m={dx:1,dy:0},d>=19e3){var v=(d/d<<3)-1;alert("Success! The key is "+(v*v*v*v*v-v-1)+"."),i("c",1),n("AI Expert",'Finishing "Snake"')}},b=new Stats;b.showPanel(1),b.dom.style.top="auto",b.dom.style.right="0",b.dom.style.bottom="0",b.dom.style.left="auto",document.body.appendChild(b.dom);!function(){var t=new Worker("./worker.js");b.begin(),t.postMessage({type:"init",scriptUrl:"data:text/javascript;base64,"+btoa(e.getValue()),w:20,h:15}),t.onmessage=function(e){var n=e.data;n>=0||-1===n?(n>0&&(m={dx:!!(4&n)-!!(1&n),dy:!!(8&n)-!!(2&n)}),S(),b.end(),c>0&&setTimeout(function(){b.begin(),t.postMessage({type:"next",data:JSON.stringify({snake:u,food:h})})},r.delay)):-10===n&&t.postMessage({type:"next",data:JSON.stringify({snake:u,food:h})})}}(),document.getElementById("game").addEventListener("click",function(){document.getElementsByClassName("intro")[0].classList.add("hidden"),document.getElementsByClassName("editor")[0].classList.add("hidden")}),document.getElementById("intro").addEventListener("click",function(){document.getElementsByClassName("intro")[0].classList.remove("hidden"),document.getElementsByClassName("editor")[0].classList.add("hidden")}),document.getElementById("code").addEventListener("click",function(){document.getElementsByClassName("intro")[0].classList.add("hidden"),document.getElementsByClassName("editor")[0].classList.remove("hidden")})}},{path:"/SmallGame/(index.html)?",init:()=>{-1===a("d")&&i("d",0)}},{path:"/SmallGame/.*/(index.html)?",init:()=>{a("d")<window.currentLevel-1&&n("Advanced",'Cut corners in "Small Game"'),i("d",window.currentLevel),void 0!==window.key&&(alert("Success! The key is "+window.key+". "),i("d",1),n("A small step to a hacker",'Finishing "Small Game"'))}},{path:"/Quine/(index.html)?",init:()=>{-1===a("e")&&i("e",0),document.getElementById("source").setAttribute("onchange","update()"),document.getElementById("source").setAttribute("onkeyup","update()");var e=/^(((print\s\d+)|(repeat\s\d+\s\d+))\n)*$/;window.update=function(){var t=document.getElementById("source").value;t.endsWith("\n")||(t+="\n");var a=""+t,o=document.getElementById("target");if(!e.test(t)){t=t.split(/\n/).slice(0,-1);for(var s=/(^print\s\d+$)|(^repeat\s\d+\s\d+$)/,r=0;r<t.length;r+=1)if(!s.test(t[r]))return void(o.value=`ERR: Syntax error at Line ${r+1}. `)}t=t.split(/\n/).slice(0,-1).map(e=>e.split(/\s/));var l=[];for(r=0;r<t.length;r+=1)if("print"===t[r][0]){if(t[r][1]=parseInt(t[r][1]),t[r][1]+r>=t.length)return void(o.value=`ERR: No enough lines to print at Line ${r+1}. `);for(var d=t[r][1];d>0;d-=1)r+=1,l.push(t[r].join(" "))}else{if(t[r][1]=parseInt(t[r][1]),t[r][2]=parseInt(t[r][2]),l.length<t[r][2])return void(o.value=`ERR: No enough lines to repeat at Line ${r+1}. `);var c=[];for(d=0;d<t[r][1];d+=1)c.push(l[l.length-t[r][2]+d%t[r][2]]);l=l.concat(c)}o.value=l.join("\n"),o.value+"\n"===a&&(alert("Success! The key is 16641. "),i("b",1),n("Achievement of Achievement",'Finishing "Quine"'))}}},{path:"/Quine/bonus.html",init:()=>{var e=window.addEventListener?"addEventListener":"attachEvent";
// Listen to message from child window
(0,window[e])("attachEvent"==e?"onmessage":"message",function(e){"Win"===e.data&&(a("e")<1&&n("Advanced II",'Finishing the bonus level before the normal one in "Quine"'),n("Quine expert",'Finishing the bonus level in "Quine"'),alert("Success! ")),console.log("parent received message!: ",e.data)},!1),window.validate=function(){var e=`<script>function win() {\n  parent.postMessage("Win");\n}\nwindow.echo = function(t) {\n  if(btoa(t) === \`${btoa(document.getElementById("ans").value)}\`) {\n    win();\n  } else {\n    console.log(t + \`\n(That's not a quine)\`);\n  }\n}<\/script>${document.getElementById("ans").value}`;return document.getElementById("test").srcdoc=e,!1}}}];o.forEach(n=>new RegExp(e+n.path+t+"$").test(location.href)?n.init():null);
